import{_ as H}from"./_plugin-vue_export-helper-BGiHQUbd.js";import{F as J}from"./index-CE6vXKKR.js";import{B as K}from"./index-D1BevRgO.js";/* empty css              */import"./index-rG4-5EJY.js";import{N as Q}from"./index-x_6tzstu.js";import{av as B,d as R,r as m,k as N,o as W,B as i,l as n,q as l,f as r,v,I as X,L as Y,F as y,s as t,z as w,an as g,am as P,A as U,a1 as z,y as x,a3 as Z,$ as V,a0 as f,t as h}from"./index-BzANx2fI.js";import{s as ee}from"./function-call-D6jw9k5t.js";import"./use-id-TOkFT5fl.js";import"./use-route-8cfyQcNc.js";import"./Dialog-BRrkhBu1.js";function oe(){return B.get("/tags")}function te(d){return B.post("/tags",d)}function se(d,k){return B.put(`/tags/${d}`,k)}function ae(d){return B.delete(`/tags/${d}`)}const le={class:"page-container tags-page"},ne={key:0,class:"loading-wrapper"},re={class:"tag-section"},ie={class:"tag-list"},ue={class:"tag-name"},ce={class:"tag-count"},de={class:"tag-section"},pe={key:0,class:"empty-tip"},me={key:1,class:"tag-list"},ve=["onClick"],ge={class:"tag-name"},fe={class:"tag-count"},_e={class:"color-picker"},ye={class:"color-options"},ke=["onClick"],Ce={class:"color-picker"},be={class:"color-options"},we=["onClick"],he={class:"popup-actions"},Be=R({__name:"index",setup(d){const k=m(!0),u=m([]),D=N(()=>u.value.filter(s=>s.type==="global")),$=N(()=>u.value.filter(s=>s.type==="custom")),C=m(!1),_=m(!1),c=m(null),a=m({name:"",color:"#07c160"}),A=["#07c160","#FF6B6B","#9B59B6","#3498DB","#1ABC9C","#2ECC71","#F39C12","#E74C3C","#34495E","#95A5A6"];W(async()=>{await I()});const I=async()=>{try{u.value=await oe()}catch{i("加载失败")}finally{k.value=!1}},S=()=>{a.value={name:"",color:"#07c160"},C.value=!0},q=s=>{if(s.type==="global"){i("全局标签不可编辑");return}c.value=s,a.value={name:s.name,color:s.color},_.value=!0},M=async()=>{if(!a.value.name.trim()){i("请输入标签名称");return}V({message:"创建中...",forbidClick:!0});try{const s=await te({name:a.value.name,color:a.value.color});u.value.push(s),C.value=!1,f(),i({message:"创建成功",type:"success"})}catch{f(),i("创建失败")}},O=async()=>{if(!a.value.name.trim()||!c.value){i("请输入标签名称");return}V({message:"更新中...",forbidClick:!0});try{const s=await se(String(c.value.id),{name:a.value.name,color:a.value.color}),e=u.value.findIndex(p=>{var b;return p.id===((b=c.value)==null?void 0:b.id)});e!==-1&&(u.value[e]=s),_.value=!1,f(),i({message:"更新成功",type:"success"})}catch{f(),i("更新失败")}},j=async()=>{if(c.value)try{await ee({title:"确认删除",message:"删除后，所有使用此标签的票迹将同步移除该标签"}),V({message:"删除中...",forbidClick:!0}),await ae(String(c.value.id)),u.value=u.value.filter(s=>{var e;return s.id!==((e=c.value)==null?void 0:e.id)}),_.value=!1,f(),i({message:"删除成功",type:"success"})}catch{f()}};return(s,e)=>{const p=X,b=Q,G=Y,F=J,T=K,E=Z;return l(),n("div",le,[r(b,{title:"标签管理","left-arrow":"",onClickLeft:e[0]||(e[0]=o=>s.$router.back())},{right:v(()=>[r(p,{name:"plus",size:"20",onClick:S})]),_:1}),k.value?(l(),n("div",ne,[r(G,{type:"spinner"})])):(l(),n(y,{key:1},[t("div",re,[e[5]||(e[5]=t("h3",{class:"section-title"},"推荐标签",-1)),t("div",ie,[(l(!0),n(y,null,w(D.value,o=>(l(),n("div",{key:o.id,class:"tag-item",style:g({borderColor:o.color})},[t("span",{class:"tag-dot",style:g({backgroundColor:o.color})},null,4),t("span",ue,h(o.name),1),t("span",ce,h(o.usageCount),1)],4))),128))])]),t("div",de,[e[6]||(e[6]=t("h3",{class:"section-title"},"我的标签",-1)),$.value.length===0?(l(),n("div",pe," 暂无自定义标签，点击右上角添加 ")):(l(),n("div",me,[(l(!0),n(y,null,w($.value,o=>(l(),n("div",{key:o.id,class:"tag-item editable",style:g({borderColor:o.color}),onClick:L=>q(o)},[t("span",{class:"tag-dot",style:g({backgroundColor:o.color})},null,4),t("span",ge,h(o.name),1),t("span",fe,h(o.usageCount),1),r(p,{name:"arrow",class:"tag-arrow"})],12,ve))),128))]))])],64)),r(E,{show:C.value,"onUpdate:show":e[2]||(e[2]=o=>C.value=o),position:"bottom",round:"",style:{padding:"20px"}},{default:v(()=>[e[9]||(e[9]=t("h3",{class:"popup-title"},"添加标签",-1)),r(F,{modelValue:a.value.name,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.name=o),label:"名称",placeholder:"请输入标签名称",maxlength:"10"},null,8,["modelValue"]),t("div",_e,[e[7]||(e[7]=t("span",{class:"color-label"},"颜色",-1)),t("div",ye,[(l(),n(y,null,w(A,o=>t("div",{key:o,class:P(["color-item",{active:a.value.color===o}]),style:g({backgroundColor:o}),onClick:L=>a.value.color=o},[a.value.color===o?(l(),U(p,{key:0,name:"success",color:"#fff"})):z("",!0)],14,ke)),64))])]),r(T,{block:"",type:"primary",onClick:M},{default:v(()=>[...e[8]||(e[8]=[x("确定",-1)])]),_:1})]),_:1},8,["show"]),r(E,{show:_.value,"onUpdate:show":e[4]||(e[4]=o=>_.value=o),position:"bottom",round:"",style:{padding:"20px"}},{default:v(()=>[e[13]||(e[13]=t("h3",{class:"popup-title"},"编辑标签",-1)),r(F,{modelValue:a.value.name,"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.name=o),label:"名称",placeholder:"请输入标签名称",maxlength:"10"},null,8,["modelValue"]),t("div",Ce,[e[10]||(e[10]=t("span",{class:"color-label"},"颜色",-1)),t("div",be,[(l(),n(y,null,w(A,o=>t("div",{key:o,class:P(["color-item",{active:a.value.color===o}]),style:g({backgroundColor:o}),onClick:L=>a.value.color=o},[a.value.color===o?(l(),U(p,{key:0,name:"success",color:"#fff"})):z("",!0)],14,we)),64))])]),t("div",he,[r(T,{block:"",type:"primary",onClick:O},{default:v(()=>[...e[11]||(e[11]=[x("保存",-1)])]),_:1}),r(T,{block:"",plain:"",type:"danger",onClick:j},{default:v(()=>[...e[12]||(e[12]=[x("删除标签",-1)])]),_:1})])]),_:1},8,["show"])])}}}),ze=H(Be,[["__scopeId","data-v-94290e42"]]);export{ze as default};
