import{aI as E,r as l,w as T,k as O}from"./index-BzANx2fI.js";const k="piaoji_tickets",u="piaoji_trash";function d(o,i){try{const a=localStorage.getItem(o);return a?JSON.parse(a):i}catch{return i}}function m(o,i){try{localStorage.setItem(o,JSON.stringify(i))}catch(a){console.error("[Storage] 保存失败:",a)}}function g(){return`${Date.now()}_${Math.random().toString(36).slice(2,11)}`}const x=E("ticket",()=>{const o=l(d(k,[])),i=l(d(u,[])),a=l(null),s=l(!1),v=l(!1);T(o,e=>m(k,e),{deep:!0}),T(i,e=>m(u,e),{deep:!0});const p=O(()=>o.value.length);async function S(e={},n=!1){s.value=!0,await new Promise(t=>setTimeout(t,300)),o.value.sort((t,c)=>{const r=new Date(t.sortTime||t.createdAt).getTime();return new Date(c.sortTime||c.createdAt).getTime()-r}),v.value=!1,s.value=!1}async function h(){i.value=d(u,[])}async function y(e){const n=o.value.find(t=>t.id===e);if(n)return a.value=n,n;throw new Error("票据不存在")}async function w(e){const n=new Date().toISOString(),t={id:g(),ticketClientId:g(),userId:"guest",name:e.name,type:e.type,tripNumber:e.tripNumber,tags:e.tags||[],price:e.price,photo:e.photo,date:e.date,sortTime:e.date||n,location:e.location,note:e.note,privacy:e.privacy||"public",isDeleted:!1,createdAt:n,updatedAt:n};return o.value=[t,...o.value],console.log("[TicketStore] 创建票据成功:",t.name),t}async function I(e,n){var r;const t=o.value.findIndex(f=>f.id===e);if(t===-1)throw new Error("票据不存在");const c={...o.value[t],...n,updatedAt:new Date().toISOString()};return o.value[t]=c,((r=a.value)==null?void 0:r.id)===e&&(a.value=c),console.log("[TicketStore] 更新票据成功:",c.name),c}async function b(e){const n=o.value.findIndex(t=>t.id===e);if(n!==-1){const t=o.value[n];t.isDeleted=!0,t.deletedAt=new Date().toISOString(),i.value=[t,...i.value],o.value=o.value.filter(c=>c.id!==e),console.log("[TicketStore] 删除票据成功:",t.name)}}async function A(e){const n=i.value.findIndex(t=>t.id===e);if(n!==-1){const t=i.value[n];t.isDeleted=!1,t.deletedAt=void 0,o.value=[t,...o.value],i.value=i.value.filter(c=>c.id!==e),console.log("[TicketStore] 恢复票据成功:",t.name)}}async function D(e){i.value=i.value.filter(n=>n.id!==e),console.log("[TicketStore] 永久删除票据成功")}function C(){}return{tickets:o,trashTickets:i,currentTicket:a,loading:s,hasMore:v,ticketCount:p,loadTickets:S,loadTrashTickets:h,loadTicketDetail:y,addTicket:w,editTicket:I,removeTicket:b,recoverTicket:A,permanentDelete:D,resetList:C}}),B={movie:{label:"电影票",icon:"video-o",color:"#FF6B6B"},show:{label:"演出票",icon:"music-o",color:"#9B59B6"},exhibition:{label:"展览票",icon:"photo-o",color:"#3498DB"},train:{label:"火车票",icon:"logistics",color:"#1ABC9C"},flight:{label:"机票",icon:"send-gift-o",color:"#2ECC71"},scenic:{label:"景区门票",icon:"location-o",color:"#F39C12"},other:{label:"其他",icon:"bookmark-o",color:"#95A5A6"}},F={public:{label:"公开",icon:"eye-o"},private:{label:"私密",icon:"eye-closed"},masked:{label:"脱敏",icon:"shield-o"}};export{F as P,B as T,x as u};
