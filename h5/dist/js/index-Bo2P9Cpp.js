import{_ as F}from"./_plugin-vue_export-helper-BGiHQUbd.js";import{B as W}from"./index-D1BevRgO.js";/* empty css              */import{C as D}from"./index-6dJEcpSY.js";import{C as E}from"./index-rG4-5EJY.js";import{I as G}from"./index-Er0kk77V.js";import{d as L,n as N,O,c as Q,k as y,f as t,ao as R,i as A,j as H,ap as J,l as f,q as h,s as n,t as k,a1 as $,y as U,x as K,v,I as X,F as Y,z as Z,a2 as tt,aq as et,B as m,_ as V}from"./index-BzANx2fI.js";import{T as ot}from"./TabBar-BTHaqLQ8.js";import"./use-route-8cfyQcNc.js";const[nt,C]=Q("progress"),at={color:String,inactive:Boolean,pivotText:String,textColor:String,showPivot:O,pivotColor:String,trackColor:String,strokeWidth:N,percentage:{type:N,default:0,validator:o=>+o>=0&&+o<=100}};var st=L({name:nt,props:at,setup(o){const _=y(()=>o.inactive?void 0:o.color),l=i=>Math.min(Math.max(+i,0),100),c=()=>{const{textColor:i,pivotText:r,pivotColor:g,percentage:u}=o,p=l(u),d=r??`${u}%`;if(o.showPivot&&d){const e={color:i,left:`${p}%`,transform:`translate(-${p}%,-50%)`,background:g||_.value};return t("span",{style:e,class:C("pivot",{inactive:o.inactive})},[d])}};return()=>{const{trackColor:i,percentage:r,strokeWidth:g}=o,u=l(r),p={background:i,height:R(g)},d={width:`${u}%`,background:_.value};return t("div",{class:C(),style:p},[t("span",{class:C("portion",{inactive:o.inactive}),style:d},null),c()])}}});const ct=A(st),rt={class:"page-container mine-page"},it={class:"user-card"},lt={class:"user-info"},ut={class:"user-detail"},pt={class:"user-name"},dt={class:"user-stat"},vt={class:"capacity-section"},_t={class:"capacity-header"},gt={class:"capacity-value"},mt={key:0,class:"capacity-tip warning"},ft={key:1,class:"capacity-tip danger"},ht={class:"logout-section"},kt=L({__name:"index",setup(o){const _=H(),l=J(),c=y(()=>l.userInfo),i=y(()=>l.usagePercent),r=y(()=>{const e=i.value;return e>=100?"danger":e>=80?"warning":"normal"}),g=[{icon:"label-o",title:"标签管理",path:"/tags"},{icon:"delete-o",title:"回收站",path:"/trash",badge:""},{icon:"comment-o",title:"意见反馈",action:"feedback"},{icon:"info-o",title:"关于我们",path:"/about"}],u=e=>{e.path?_.push(e.path):e.action==="feedback"&&m("功能开发中")},p=async()=>{var e;if((e=c.value)!=null&&e.phone){m("已绑定手机号");return}try{await V.bindPhone(),await l.fetchUserInfo(),m("绑定成功")}catch(a){a.message!=="user_cancel"&&m("绑定失败")}},d=()=>{l.clearToken(),m("已退出登录"),V.navigateBack()};return(e,a)=>{var P,B,S,I,T;const M=G,j=ct,b=X,w=E,x=D,q=et,z=W;return h(),f("div",rt,[n("div",it,[n("div",lt,[t(M,{round:"",width:"64",height:"64",src:((P=c.value)==null?void 0:P.avatarUrl)||"https://img.yzcdn.cn/vant/cat.jpeg",fit:"cover"},null,8,["src"]),n("div",ut,[n("h2",pt,k(((B=c.value)==null?void 0:B.nickName)||"票迹用户"),1),n("p",dt,"已收藏 "+k(((S=c.value)==null?void 0:S.ticketCount)||0)+" 张票迹",1)])]),n("div",vt,[n("div",_t,[a[1]||(a[1]=n("span",{class:"capacity-label"},"存储容量",-1)),n("span",gt,k(((I=c.value)==null?void 0:I.photoCount)||0)+" / "+k(((T=c.value)==null?void 0:T.photoQuota)||100),1)]),t(j,{percentage:i.value,"show-pivot":!1,color:r.value==="danger"?"#ee0a24":r.value==="warning"?"#ff976a":"#07c160","track-color":"#ebedf0"},null,8,["percentage","color"]),r.value==="warning"?(h(),f("p",mt,[a[2]||(a[2]=U(" 容量即将用完，",-1)),n("span",{onClick:a[0]||(a[0]=s=>K(_).push("/trash"))},"去清理")])):$("",!0),r.value==="danger"?(h(),f("p",ft," 已达上限，请清理回收站 ")):$("",!0)])]),t(x,{inset:"",class:"phone-section"},{default:v(()=>{var s;return[t(w,{title:"手机号",value:((s=c.value)==null?void 0:s.phone)||"未绑定","is-link":"",onClick:p},{icon:v(()=>[t(b,{name:"phone-o",class:"cell-icon"})]),_:1},8,["value"])]}),_:1}),t(x,{inset:""},{default:v(()=>[(h(),f(Y,null,Z(g,s=>t(w,{key:s.title,title:s.title,"is-link":"",onClick:yt=>u(s)},tt({icon:v(()=>[t(b,{name:s.icon,class:"cell-icon"},null,8,["name"])]),_:2},[s.badge?{name:"value",fn:v(()=>[t(q,{content:s.badge},null,8,["content"])]),key:"0"}:void 0]),1032,["title","onClick"])),64))]),_:1}),n("div",ht,[t(z,{block:"",plain:"",type:"default",onClick:d},{default:v(()=>[...a[3]||(a[3]=[U(" 退出登录 ",-1)])]),_:1})]),t(ot)])}}}),Nt=F(kt,[["__scopeId","data-v-3a5471d0"]]);export{Nt as default};
