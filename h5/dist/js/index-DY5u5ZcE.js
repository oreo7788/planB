import{_ as A}from"./_plugin-vue_export-helper-BGiHQUbd.js";import{B as z}from"./index-D1BevRgO.js";import{E as R}from"./index-CTocSTSQ.js";/* empty css              */import{d as M,m as H,n as Y,c as U,r as P,u as j,a as q,b as G,w as X,e as J,f as r,L as K,g as O,h as Q,p as W,i as Z,j as tt,k as I,o as st,l as _,q as v,s as e,I as et,t as x,v as w,x as $,y as at,F as V,z as L,A as nt,B as F}from"./index-BzANx2fI.js";import{u as ot}from"./index-Das1Xvnf.js";import{T as it}from"./TicketCard-Dj5XU2Pu.js";import{T as lt}from"./TabBar-BTHaqLQ8.js";import"./use-route-8cfyQcNc.js";import"./use-id-TOkFT5fl.js";import"./index-Er0kk77V.js";const[ct,T,rt]=U("pull-refresh"),N=50,ut=["pulling","loosing","success"],dt={disabled:Boolean,modelValue:Boolean,headHeight:H(N),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:Y,successDuration:H(500),animationDuration:H(300)};var mt=M({name:ct,props:dt,emits:["change","refresh","update:modelValue"],setup(n,{emit:m,slots:c}){let u;const g=P(),k=P(),D=j(g),a=q({status:"normal",distance:0,duration:0}),h=G(),b=()=>{if(n.headHeight!==N)return{height:`${n.headHeight}px`}},l=()=>a.status!=="loading"&&a.status!=="success"&&!n.disabled,s=t=>{const i=+(n.pullDistance||n.headHeight);return t>i&&(t<i*2?t=i+(t-i)/2:t=i*1.5+(t-i*2)/4),Math.round(t)},o=(t,i)=>{const p=+(n.pullDistance||n.headHeight);a.distance=t,i?a.status="loading":t===0?a.status="normal":t<p?a.status="pulling":a.status="loosing",m("change",{status:a.status,distance:t})},d=()=>{const{status:t}=a;return t==="normal"?"":n[`${t}Text`]||rt(t)},E=()=>{const{status:t,distance:i}=a;if(c[t])return c[t]({distance:i});const p=[];return ut.includes(t)&&p.push(r("div",{class:T("text")},[d()])),t==="loading"&&p.push(r(K,{class:T("loading")},{default:d})),p},B=()=>{a.status="success",setTimeout(()=>{o(0)},+n.successDuration)},f=t=>{u=Q(D.value)===0,u&&(a.duration=0,h.start(t))},y=t=>{l()&&f(t)},S=t=>{if(l()){u||f(t);const{deltaY:i}=h;h.move(t),u&&i.value>=0&&h.isVertical()&&(W(t),o(s(i.value)))}},C=()=>{u&&h.deltaY.value&&l()&&(a.duration=+n.animationDuration,a.status==="loosing"?(o(+n.headHeight,!0),m("update:modelValue",!0),O(()=>m("refresh"))):o(0))};return X(()=>n.modelValue,t=>{a.duration=+n.animationDuration,t?o(+n.headHeight,!0):c.success||n.successText?B():o(0,!1)}),J("touchmove",S,{target:k}),()=>{var t;const i={transitionDuration:`${a.duration}ms`,transform:a.distance?`translate3d(0,${a.distance}px, 0)`:""};return r("div",{ref:g,class:T()},[r("div",{ref:k,class:T("track"),style:i,onTouchstartPassive:y,onTouchend:C,onTouchcancel:C},[r("div",{class:T("head"),style:b()},[E()]),(t=c.default)==null?void 0:t.call(c)])])}}});const ht=Z(mt),ft={class:"page-container home-page"},vt={class:"glass-nav"},gt={class:"nav-right"},_t={class:"stats-section"},pt={class:"stats-grid"},Tt={class:"stat-card"},kt={class:"stat-value"},yt={class:"stat-card"},St={class:"stat-value"},xt={class:"stat-card"},Dt={class:"stat-value"},bt={key:0,class:"empty-state"},Et={key:1,class:"timeline-content"},Bt={class:"month-header"},Ht={class:"month-title"},wt={class:"ticket-list"},Vt=M({__name:"index",setup(n){const m=tt(),c=ot(),u=P(!1),g=I(()=>({total:c.tickets.length,cities:new Set(c.tickets.map(l=>{var o;const s=l.location;return(s==null?void 0:s.city)||((o=s==null?void 0:s.departure)==null?void 0:o.city)}).filter(Boolean)).size,year:new Date().getFullYear()})),k=I(()=>{const l={};return c.tickets.forEach(s=>{const o=s.date?new Date(s.date):new Date(s.createdAt),d=`${o.getFullYear()}年${o.getMonth()+1}月`;l[d]||(l[d]=[]),l[d].push(s)}),l});st(()=>{console.log("[Home] 页面加载，当前票据数:",c.tickets.length)});const D=async()=>{u.value=!0,await c.loadTickets({},!0),u.value=!1,F("刷新完成")},a=l=>{m.push(`/detail/${l.id}`)},h=()=>{F("搜索功能开发中")},b=()=>{m.push("/mine")};return(l,s)=>{const o=et,d=z,E=R,B=ht;return v(),_("div",ft,[e("header",vt,[s[2]||(s[2]=e("div",{class:"nav-left"},[e("h1",{class:"app-title"},"票迹"),e("p",{class:"app-subtitle"},"LIFE TIMELINE")],-1)),e("div",gt,[e("button",{class:"nav-btn",onClick:h},[r(o,{name:"search",size:"20"})]),e("button",{class:"nav-btn",onClick:b},[r(o,{name:"user-o",size:"20"})])])]),e("section",_t,[e("div",pt,[e("div",Tt,[e("div",kt,x(g.value.total),1),s[3]||(s[3]=e("div",{class:"stat-label"},"总票数",-1))]),e("div",yt,[e("div",St,x(g.value.cities),1),s[4]||(s[4]=e("div",{class:"stat-label"},"足迹城市",-1))]),e("div",xt,[e("div",Dt,x(g.value.year),1),s[5]||(s[5]=e("div",{class:"stat-label"},"当前年份",-1))])])]),r(B,{modelValue:u.value,"onUpdate:modelValue":s[1]||(s[1]=f=>u.value=f),onRefresh:D},{default:w(()=>[$(c).tickets.length===0?(v(),_("div",bt,[r(E,{description:"暂无票迹"},{default:w(()=>[r(d,{round:"",type:"primary",onClick:s[0]||(s[0]=f=>$(m).push("/add"))},{default:w(()=>[...s[6]||(s[6]=[at(" 添加第一张票迹 ",-1)])]),_:1})]),_:1})])):(v(),_("main",Et,[s[8]||(s[8]=e("div",{class:"timeline-line"},null,-1)),(v(!0),_(V,null,L(k.value,(f,y)=>(v(),_(V,{key:y},[e("div",Bt,[s[7]||(s[7]=e("div",{class:"timeline-dot"},null,-1)),e("h2",Ht,x(y),1)]),e("div",wt,[(v(!0),_(V,null,L(f,S=>(v(),nt(it,{key:S.id,ticket:S,onClick:a},null,8,["ticket"]))),128))])],64))),128))]))]),_:1},8,["modelValue"]),r(lt)])}}}),Yt=A(Vt,[["__scopeId","data-v-87ec8f7a"]]);export{Yt as default};
